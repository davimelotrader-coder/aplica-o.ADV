<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados do Diagn√≥stico - Legal Ops</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .results-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .overall-score {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .score-number {
            font-size: 4rem;
            font-weight: 700;
            margin: 0;
        }

        .score-label {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .dimension-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .dimension-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .dimension-score {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .dimension-bar {
            height: 8px;
            background: var(--background);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .dimension-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            transition: width 0.5s ease;
        }

        .chart-container {
            background: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            margin: 2rem 0;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 2rem auto;
            max-width: 600px;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 3rem 0;
            flex-wrap: wrap;
        }

        .btn-download {
            background: var(--success-color);
            color: white;
        }

        .btn-download:hover {
            background: #059669;
        }

        .info-section {
            background: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin: 2rem 0;
        }

        .privacy-note {
            background: #eff6ff;
            border-left: 4px solid var(--primary-color);
            padding: 1rem 1.5rem;
            border-radius: 4px;
            margin: 2rem 0;
        }

        @media (max-width: 768px) {
            .score-number {
                font-size: 3rem;
            }

            .dimensions-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="results-container">
        <div class="results-header">
            <h1>Resultados do Diagn√≥stico Operacional</h1>
            <p class="subtitle">An√°lise completa da sua opera√ß√£o jur√≠dica</p>
        </div>

        <!-- Overall Score -->
        <div class="overall-score">
            <p class="score-number" id="overall-score">--</p>
            <p class="score-label" id="overall-interpretation">Carregando...</p>
        </div>

        <!-- Dimensions Grid -->
        <div class="dimensions-grid" id="dimensions-grid">
            <!-- Populated by JavaScript -->
        </div>

        <!-- Radar Chart -->
        <div class="chart-container">
            <h2>Vis√£o Geral das Dimens√µes</h2>
            <div class="chart-wrapper">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-download" id="download-pdf-btn">
                üì• Baixar Relat√≥rio (PDF)
            </button>
            <button class="btn btn-secondary" id="copy-link-btn">
                üîó Copiar Link Permanente
            </button>
            <button class="btn btn-secondary" id="new-diagnostic-btn">
                ‚Üª Novo Diagn√≥stico
            </button>
        </div>

        <!-- Information Section -->
        <div class="info-section">
            <h3>Sobre Seus Resultados</h3>
            <p>Este diagn√≥stico analisou 5 dimens√µes operacionais do seu escrit√≥rio:</p>
            <ul>
                <li><strong>Efici√™ncia Operacional:</strong> Processos, automa√ß√£o e produtividade</li>
                <li><strong>Prote√ß√£o de Receita:</strong> Faturamento, cobran√ßa e controle financeiro</li>
                <li><strong>Experi√™ncia do Cliente:</strong> Comunica√ß√£o e satisfa√ß√£o</li>
                <li><strong>Gest√£o de Riscos:</strong> Conformidade, prazos e seguran√ßa</li>
                <li><strong>Visibilidade Estrat√©gica:</strong> M√©tricas e tomada de decis√£o</li>
            </ul>
        </div>

        <!-- Privacy Note -->
        <div class="privacy-note">
            <p>üîê <strong>Privacidade Garantida:</strong> Este diagn√≥stico √© individual e exclusivo. Seus dados n√£o
                foram comparados com outros escrit√≥rios e permanecem completamente privados.</p>
        </div>

        <!-- Session Info -->
        <div style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-top: 2rem;">
            <p>Diagn√≥stico ID: <code id="session-id">--</code></p>
            <p>Conclu√≠do em: <span id="completed-at">--</span></p>
        </div>
    </div>

    <script>
        // Get session ID from URL
        const pathParts = window.location.pathname.split('/');
        const sessionId = pathParts[pathParts.length - 1];

        // Load results
        async function loadResults() {
            try {
                const response = await fetch(`/api/results/${sessionId}`);

                if (!response.ok) {
                    throw new Error('Failed to load results');
                }

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('Error loading results:', error);
                alert('Erro ao carregar resultados. Verifique se o diagn√≥stico foi conclu√≠do.');
                window.location.href = '/';
            }
        }

        function displayResults(data) {
            const { scores, completedAt, sessionId: sid } = data;

            // Overall score
            document.getElementById('overall-score').textContent = scores.overall;
            document.getElementById('overall-interpretation').textContent = scores.interpretation;

            // Dimensions
            const dimensionsGrid = document.getElementById('dimensions-grid');
            const dimensionNames = {
                efficiency: 'Efici√™ncia Operacional',
                revenue: 'Prote√ß√£o de Receita',
                client: 'Experi√™ncia do Cliente',
                risk: 'Gest√£o de Riscos',
                strategic: 'Visibilidade Estrat√©gica'
            };

            dimensionsGrid.innerHTML = '';
            Object.keys(scores.dimensions).forEach(key => {
                const score = scores.dimensions[key];
                const card = document.createElement('div');
                card.className = 'dimension-card';
                card.innerHTML = `
                    <div class="dimension-name">${dimensionNames[key]}</div>
                    <div class="dimension-score">${score}</div>
                    <div class="dimension-bar">
                        <div class="dimension-bar-fill" style="width: ${score}%"></div>
                    </div>
                `;
                dimensionsGrid.appendChild(card);
            });

            // Radar chart
            createRadarChart(scores.dimensions, dimensionNames);

            // Session info
            document.getElementById('session-id').textContent = sid;
            document.getElementById('completed-at').textContent = new Date(completedAt).toLocaleString('pt-BR');
        }

        function createRadarChart(dimensions, names) {
            const ctx = document.getElementById('radarChart').getContext('2d');

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(dimensions).map(key => names[key]),
                    datasets: [{
                        label: 'Pontua√ß√£o',
                        data: Object.values(dimensions),
                        backgroundColor: 'rgba(30, 64, 175, 0.2)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(30, 64, 175, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(30, 64, 175, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Button handlers
        document.getElementById('download-pdf-btn').addEventListener('click', () => {
            // TODO: Implement PDF download
            alert('Funcionalidade de download de PDF ser√° implementada em breve!');
        });

        document.getElementById('copy-link-btn').addEventListener('click', () => {
            const link = window.location.href;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copiado para a √°rea de transfer√™ncia!');
            });
        });

        document.getElementById('new-diagnostic-btn').addEventListener('click', () => {
            if (confirm('Deseja iniciar um novo diagn√≥stico?')) {
                window.location.href = '/';
            }
        });

        // Load results on page load
        loadResults();
    </script>
</body>

</html>